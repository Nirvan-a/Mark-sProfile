# Fly.io 配置文件
# 使用命令部署: flyctl deploy
# 首次部署: flyctl launch（会提示创建应用）

app = "profile-page-api"
primary_region = "iad"  # 选择离你最近的区域（可选：sin, nrt, hkg 等）

[build]
  # Fly.io 会自动检测 Python 项目并使用 pip 安装依赖

[env]
  PORT = "8001"
  PYTHON_VERSION = "3.11.0"

[http_service]
  internal_port = 8001
  force_https = true
  auto_stop_machines = true    # 无活动时自动停止以节省成本
  auto_start_machines = true   # 有请求时自动启动（冷启动约 2-5 秒）
  min_machines_running = 0     # 最小运行实例数（0 = 允许完全停止）
  processes = ["app"]

# 构建和启动命令
[build.args]
  # 构建参数会在 Dockerfile 中使用，或在 fly.toml 中通过 [deploy] 配置

[deploy]
  # 如果使用 Dockerfile，Fly.io 会自动识别
  # 如果需要自定义构建命令，可以在这里配置

[[vm]]
  cpu_kind = "shared"
  cpus = 1
  memory_mb = 256  # 256MB 对于 FastAPI 应用通常足够

